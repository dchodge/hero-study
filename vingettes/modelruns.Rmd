---
title: "modelruns"
author: "David Hodgson"
date: "11/02/2021"
output: html_document
---


# Model A. Seroprevalence model

```{r model A}

prev <- init_model_prev("prev", "sero_pos", datafit_prev, "sero_prev")
asymp <- init_model_prev("asymp", "asymp_pos", datafit_asymp, "asymp")

fit(prev)
fit(asymp)

clean_samples(prev)
clean_samples(asymp)

plot(prev, x_axis_str = "Seroprevalence", "Fig1", 8, 6)
plot(asymp, x_axis_str = "Proportion Asymptomatic", "FigS1",  8, 6)


```

# Model B. AB kinetics model

```{r model B}

inter_start <- c("marginal_a_i", "marginal_e_i", "marginal_g_i", "marginal_s_i")
slope_change <- c("marginal_a_s", "marginal_e_s", "marginal_g_s", "marginal_s_s")

start <- init_model_ab_kin(name = "start",
                           stan_file = "start",
                           datafit = datafit_start,
                           marginal_vars = inter_start)
change <- init_model_ab_kin(name = "change",
                            stan_file = "change",
                            datafit = datafit_change,
                            marginal_vars = slope_change)

# Run the mcmc sampler on these fits
fit(start)
fit(change)

# Clean the mcmc samples
clean_samples(start)
clean_samples(change)
clean_samples_revert(start, change)

# Plot figs
plot(start)
plot(change)
plot_revert(start, change)

# Plot final figurre
plot_figure_2(start, change, 8, 8)

```

# Model C. Commercial assay model

```{r model C}

sens <- test_metric("Sensitivity", 60:100, datafit_seropos, `>`)
spec <- test_metric("Specificity", 60:100, datafit_seroneg, `<`)

fit(sens)
fit(spec)

plot(sens, 10, 10, "fig3_sens")
plot(spec, 10, 10, "fig3_spec")

```


# Supplementary figures

```{r Supp}

plot_dates()
plot_correlations()
plot_time_supp(10, 10)

plot_od_sens_curve(10, 10)
plot_roc(10, 10)
plot_roc_age(10, 10)
```